"use strict";(()=>{var e={};e.id=939,e.ids=[939],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},4977:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>j,requestAsyncStorage:()=>y,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>x});var a={};r.r(a),r.d(a,{DELETE:()=>b,GET:()=>m,POST:()=>g,PUT:()=>N,dynamic:()=>p,revalidate:()=>c});var s=r(9303),o=r(8716),n=r(670),i=r(7070),u=r(3493),l=r(9178);function d(e){let t=e.amount&&"function"==typeof e.amount.toNumber?e.amount.toNumber():Number(e.amount);return{id:e.id,title:e.title,amount:t,category:e.category,dueDay:e.dueDay,userId:e.userId,payCycleId:e.payCycleId??null,createdAt:e.createdAt,updatedAt:e.updatedAt}}let p="force-dynamic",c=0;async function m(e){let t=(0,l.W)(e.headers.get("authorization"));if(!t)return i.NextResponse.json({message:"N\xe3o autorizado"},{status:401});try{let e=await u._.obligation.findMany({where:{userId:t},orderBy:{dueDay:"asc"}});return i.NextResponse.json(e.map(d))}catch(e){return console.error("Erro ao buscar obriga\xe7\xf5es",e),i.NextResponse.json({message:"Erro interno ao listar obriga\xe7\xf5es"},{status:500})}}async function g(e){let t=(0,l.W)(e.headers.get("authorization"));if(!t)return i.NextResponse.json({message:"N\xe3o autorizado"},{status:401});let{title:r,amount:a,category:s,dueDay:o,payCycleId:n}=await e.json(),p=parseFloat(a),c=Number(o);if(!r||Number.isNaN(p)||Number.isNaN(c))return i.NextResponse.json({message:"Preencha t\xedtulo, valor e dia."},{status:400});let m=null;if(null!=n&&""!==n){let e=Number(n);if(Number.isNaN(e))return i.NextResponse.json({message:"Ciclo de pagamento inv\xe1lido"},{status:400});let r=await u._.payCycle.findUnique({where:{id:e}});if(!r||r.userId!==t)return i.NextResponse.json({message:"Ciclo de pagamento n\xe3o encontrado"},{status:404});m=e}try{let e=await u._.obligation.create({data:{title:r,amount:p,category:s||null,dueDay:c,payCycleId:m,userId:t}});return i.NextResponse.json(d(e),{status:201})}catch(e){return console.error("Erro ao criar obriga\xe7\xe3o",e),i.NextResponse.json({message:"Erro interno ao criar obriga\xe7\xe3o"},{status:500})}}async function N(e){let t=new URL(e.url).searchParams.get("id"),r=(0,l.W)(e.headers.get("authorization"));if(!r)return i.NextResponse.json({message:"N\xe3o autorizado"},{status:401});let a=Number(t);if(Number.isNaN(a))return i.NextResponse.json({message:"ID inv\xe1lido"},{status:400});let{title:s,amount:o,category:n,dueDay:p,payCycleId:c}=await e.json(),m={};if(void 0!==s&&(m.title=s),void 0!==n&&(m.category=n||null),void 0!==o){let e=parseFloat(o);if(Number.isNaN(e))return i.NextResponse.json({message:"Valor inv\xe1lido"},{status:400});m.amount=e}if(void 0!==p){let e=Number(p);if(Number.isNaN(e))return i.NextResponse.json({message:"Dia inv\xe1lido"},{status:400});m.dueDay=e}if(void 0!==c){if(null===c||""===c)m.payCycleId=null;else{let e=Number(c);if(Number.isNaN(e))return i.NextResponse.json({message:"Ciclo de pagamento inv\xe1lido"},{status:400});let t=await u._.payCycle.findUnique({where:{id:e}});if(!t||t.userId!==r)return i.NextResponse.json({message:"Ciclo de pagamento n\xe3o encontrado"},{status:404});m.payCycleId=e}}try{let e=await u._.obligation.findUnique({where:{id:a}});if(!e||e.userId!==r)return i.NextResponse.json({message:"Obriga\xe7\xe3o n\xe3o encontrada"},{status:404});let t=await u._.obligation.update({where:{id:a},data:m});return i.NextResponse.json(d(t))}catch(e){return console.error("Erro ao atualizar obriga\xe7\xe3o",e),i.NextResponse.json({message:"Erro interno ao atualizar"},{status:500})}}async function b(e){let t=new URL(e.url).searchParams.get("id"),r=(0,l.W)(e.headers.get("authorization"));if(!r)return i.NextResponse.json({message:"N\xe3o autorizado"},{status:401});let a=Number(t);if(Number.isNaN(a))return i.NextResponse.json({message:"ID inv\xe1lido"},{status:400});try{let e=await u._.obligation.findUnique({where:{id:a}});if(!e||e.userId!==r)return i.NextResponse.json({message:"Obriga\xe7\xe3o n\xe3o encontrada"},{status:404});return await u._.obligation.delete({where:{id:a}}),i.NextResponse.json({},{status:204})}catch(e){return console.error("Erro ao excluir obriga\xe7\xe3o",e),i.NextResponse.json({message:"Erro interno ao excluir obriga\xe7\xe3o"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/obligations/route",pathname:"/api/obligations",filename:"route",bundlePath:"app/api/obligations/route"},resolvedPagePath:"C:\\Users\\User\\Desktop\\controle-gastos\\backend\\app\\api\\obligations\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:x,serverHooks:h}=f,R="/api/obligations/route";function j(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:x})}},9178:(e,t,r)=>{r.d(t,{R:()=>n,W:()=>i});var a=r(1482),s=r.n(a);let o=process.env.JWT_SECRET||"change-me";function n(e){return s().sign({userId:e},o,{expiresIn:"7d"})}function i(e){if(!e||!e.startsWith("Bearer "))return null;let t=e.split(" ")[1];try{return s().verify(t,o).userId}catch(e){return null}}},3493:(e,t,r)=>{r.d(t,{_:()=>s});let a=require("@prisma/client"),s=globalThis.prisma||new a.PrismaClient({log:["error","warn"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,547],()=>r(4977));module.exports=a})();